<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å°¼æ£®ç¾èªç¹³è²»é€šçŸ¥å–®</title> 
    <style>
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fff8e1;
            color: #333;
            font-size: 110%;
            line-height: 1.6;
        }
        .header {
            background-color: #ff9800;
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header h1 {
            margin: 5px 0;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        h2 {
            color: #d32f2f;
            border-bottom: 2px solid #ff9800;
            padding-bottom: 5px;
            margin-top: 30px;
            font-size: 1.8em;
        }
        h3 {
            color: #4CAF50;
            border-left: 5px solid #4CAF50;
            padding-left: 10px;
            margin-top: 30px;
            font-size: 1.4em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 1em;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 12px 10px;
            text-align: center;
            overflow: hidden;
        }
        th {
            background-color: #f5e0a9;
            color: #333;
        }
        th:nth-child(1), td:nth-child(1) { width: 35%; }
        th:nth-child(2), td:nth-child(2) { width: 20%; }
        th:nth-child(3), td:nth-child(3) { width: 25%; }
        th:nth-child(4), td:nth-child(4) { width: 20%; }

        td:nth-child(1) {
            font-weight: bold;
            text-align: center;
        }
        td[id^="price-"], td[id^="subtotal-"] {
            font-size: 1.15em; 
            font-weight: bold; 
            color: #333;
        }
        .input-group {
            display: flex; 
            align-items: stretch; 
            justify-content: center;
            max-width: 280px; 
            margin: 0 auto;
            gap: 5px; 
        }
        input {
            width: 60px; 
            padding: 8px 5px;
            text-align: center; 
            border: 1px solid #ccc;
            border-radius: 4px; 
            font-size: 16px; 
            margin: 0; 
        }
        /* å¯¦æ”¶é‡‘é¡å°ˆç”¨æ¨£å¼ */
        #received-amount {
            width: 100px;
            font-size: 1.2em;
            font-weight: bold;
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }
        .qty-button {
            background-color: #4CAF50; 
            color: white;
            border: 1px solid #4CAF50; 
            width: 40px; 
            padding: 8px 0; 
            cursor: pointer;
            font-size: 16px; 
            font-weight: bold;
            line-height: 1; 
            transition: background-color 0.2s;
            border-radius: 4px; 
            margin: 0; 
        }
        .qty-button:hover {
            background-color: #43A047;
        }
        .total-row td {
            font-weight: bold;
            background-color: #ffe0b2;
        }
        .change-row td {
            font-weight: bold;
            background-color: #e8f5e9;
        }
        .total-label {
            text-align: right !important;
            padding-right: 20px;
            font-size: 1.2em;
        }
        #grand-total, #change-amount {
            font-size: 1.6em !important; 
            font-weight: bold;
            color: #d32f2f; 
            text-align: center !important;
        }
        #change-amount {
            color: #2e7d32; /* æ‰¾é›¶ä½¿ç”¨ç¶ è‰² */
        }
        .action-buttons-container {
            display: flex;
            justify-content: space-between; 
            align-items: flex-start;
            margin-top: 20px;
            gap: 10px;
        }
        .left-buttons-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .right-buttons-group {
            display: flex;
            gap: 10px;
        }
        .button-common {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1em;
            color: white;
            text-align: center;
        }
        .export-button { background-color: #2196F3; }
        .export-button:hover { background-color: #1976D2; }
        .delete-all-button, .clear-button { background-color: #f44336; }
        .delete-all-button:hover, .clear-button:hover { background-color: #d32f2f; }
        .save-button { background-color: #4CAF50; }
        .save-button:hover { background-color: #43A047; }
    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ¥Ÿ ç´ é£Ÿç”Ÿç…åŒ… ğŸ¥Ÿ</h1>
    </div>

    <div class="container">
        
        <h2>å“é …èˆ‡é‡‘é¡è¨ˆç®—</h2>

        <h3>ä¸»é£Ÿ</h3>
        <table>
            <thead>
                <tr>
                    <th>å“é …åç¨±</th>
                    <th>å–®åƒ¹ (NT$)</th>
                    <th>è³¼è²·æ•¸é‡</th>
                    <th>å°è¨ˆ (NT$)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ç´ é£Ÿç”Ÿç…åŒ…</td>
                    <td id="price-sjb">6</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-sjb" inputmode="numeric" pattern="[0-9]*" oninput="calculateTotal()">
                            <button class="qty-button decrement" onclick="adjustQuantity('qty-sjb', -1)">-</button>
                            <button class="qty-button increment" onclick="adjustQuantity('qty-sjb', 1)">+</button>
                        </div>
                    </td>
                    <td id="subtotal-sjb">0</td>
                </tr>
                <tr>
                    <td>ç…é¹¹é¤…</td>
                    <td id="price-xb">25</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-xb" inputmode="numeric" pattern="[0-9]*" oninput="calculateTotal()">
                            <button class="qty-button decrement" onclick="adjustQuantity('qty-xb', -1)">-</button>
                            <button class="qty-button increment" onclick="adjustQuantity('qty-xb', 1)">+</button>
                        </div>
                    </td>
                    <td id="subtotal-xb">0</td>
                </tr>
                <tr>
                    <td>ç´ éºµç·šç¾¹</td>
                    <td id="price-mxg">35</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-mxg" inputmode="numeric" pattern="[0-9]*" oninput="calculateTotal()">
                            <button class="qty-button decrement" onclick="adjustQuantity('qty-mxg', -1)">-</button>
                            <button class="qty-button increment" onclick="adjustQuantity('qty-mxg', 1)">+</button>
                        </div>
                    </td>
                    <td id="subtotal-mxg">0</td>
                </tr>
            </tbody>
        </table>
        
        <h3>é£²å“</h3>
        <table>
            <thead>
                <tr>
                    <th>å“é …åç¨±</th>
                    <th>å–®åƒ¹ (NT$)</th>
                    <th>è³¼è²·æ•¸é‡</th>
                    <th>å°è¨ˆ (NT$)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>è±†æ¼¿</td>
                    <td id="price-dz">20</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-dz" inputmode="numeric" pattern="[0-9]*" oninput="calculateTotal()">
                            <button class="qty-button decrement" onclick="adjustQuantity('qty-dz', -1)">-</button>
                            <button class="qty-button increment" onclick="adjustQuantity('qty-dz', 1)">+</button>
                        </div>
                    </td>
                    <td id="subtotal-dz">0</td>
                </tr>
                <tr>
                    <td>ç´…èŒ¶</td>
                    <td id="price-hc">20</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-hc" inputmode="numeric" pattern="[0-9]*" oninput="calculateTotal()">
                            <button class="qty-button decrement" onclick="adjustQuantity('qty-hc', -1)">-</button>
                            <button class="qty-button increment" onclick="adjustQuantity('qty-hc', 1)">+</button>
                        </div>
                    </td>
                    <td id="subtotal-hc">0</td>
                </tr>
                <tr>
                    <td>ç´…èŒ¶è±†æ¼¿</td>
                    <td id="price-hcdz">20</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-hcdz" inputmode="numeric" pattern="[0-9]*" oninput="calculateTotal()">
                            <button class="qty-button decrement" onclick="adjustQuantity('qty-hcdz', -1)">-</button>
                            <button class="qty-button increment" onclick="adjustQuantity('qty-hcdz', 1)">+</button>
                        </div>
                    </td>
                    <td id="subtotal-hcdz">0</td>
                </tr>
                <tr>
                    <td>é®®å¥¶èŒ¶</td>
                    <td id="price-xnt">35</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-xnt" inputmode="numeric" pattern="[0-9]*" oninput="calculateTotal()">
                            <button class="qty-button decrement" onclick="adjustQuantity('qty-xnt', -1)">-</button>
                            <button class="qty-button increment" onclick="adjustQuantity('qty-xnt', 1)">+</button>
                        </div>
                    </td>
                    <td id="subtotal-xnt">0</td>
                </tr>
            </tbody>
        </table>

        <table style="margin-top: 40px;">
            <tr class="total-row">
                <td class="total-label" style="border-right: none;"><strong>ç¸½è¨ˆé‡‘é¡</strong></td>
                <td id="grand-total" style="border-left: none; width: 35%;">0</td>
            </tr>
            <tr>
                <td class="total-label" style="border-right: none; background-color: #fffde7;"><strong>å¯¦æ”¶é‡‘é¡</strong></td>
                <td style="border-left: none; width: 35%; background-color: #fffde7;">
                    <input type="tel" id="received-amount" inputmode="numeric" pattern="[0-9]*" placeholder="è¼¸å…¥é‡‘é¡" oninput="calculateChange()">
                </td>
            </tr>
            <tr class="change-row">
                <td class="total-label" style="border-right: none;"><strong>æ‡‰æ‰¾é›¶éŒ¢</strong></td>
                <td id="change-amount" style="border-left: none; width: 35%;">0</td>
            </tr>
        </table>

        <div class="action-buttons-container">
            <div class="left-buttons-group">
                <button class="button-common export-button" onclick="exportToCSV()">åŒ¯å‡ºæ­·å²ç´€éŒ„ (CSV)</button>
                <button class="button-common delete-all-button" onclick="deleteAllOrders()">æ¸…ç©ºæ‰€æœ‰ç´€éŒ„</button>
            </div>
            
            <div class="right-buttons-group">
                <button class="button-common save-button" onclick="saveOrder()">å„²å­˜è¨‚å–®</button>
                <button class="button-common clear-button" onclick="clearQuantities()">æ¸…ç©ºå…¨éƒ¨æ¬„ä½</button>
            </div>
        </div>
        
        <p style="text-align: center; margin-top: 15px; font-size: 0.9em; color: #666;">v260105.10</p>
        
        <div id="history-container">
            <h2 style="margin-top: 40px; border-bottom: 2px solid #4CAF50; color: #4CAF50;">æ­·å²è¨‚å–®è¨˜éŒ„</h2>
            <p id="no-history-msg" style="color: #999; text-align: center; margin-top: 20px;">é»æ“Šã€Œå„²å­˜è¨‚å–®ã€å¾Œï¼Œè¨‚å–®å°‡æœƒé¡¯ç¤ºåœ¨æ­¤è™•ã€‚</p>
        </div>

    </div>

    <script>
        const items = ['sjb', 'xb', 'mxg', 'dz', 'hc', 'hcdz', 'xnt'];

        window.onload = function() {
            const savedHistory = localStorage.getItem('orderHistory');
            if (savedHistory && savedHistory.trim() !== "") {
                const historyContainer = document.getElementById('history-container');
                const noHistoryMsg = document.getElementById('no-history-msg');
                if (noHistoryMsg) noHistoryMsg.remove();
                historyContainer.innerHTML += savedHistory;
            }
            calculateTotal();
        };

        function updateLocalStorage() {
            const orderItems = document.querySelectorAll('.saved-order-item');
            let combinedHTML = "";
            orderItems.forEach(item => {
                combinedHTML += item.outerHTML;
            });
            localStorage.setItem('orderHistory', combinedHTML);
        }

        function adjustQuantity(itemId, change) {
            const qtyInput = document.getElementById(itemId);
            let currentQty = parseInt(qtyInput.value) || 0;
            let newQty = Math.max(0, currentQty + change);
            qtyInput.value = (newQty === 0) ? '' : newQty;
            calculateTotal();
        }

        function calculateTotal() {
            let grandTotal = 0;
            items.forEach(item => {
                const priceElement = document.getElementById(`price-${item}`);
                const qtyElement = document.getElementById(`qty-${item}`);
                const subtotalElement = document.getElementById(`subtotal-${item}`);
                if (priceElement && qtyElement && subtotalElement) {
                    const price = parseFloat(priceElement.textContent);
                    const qty = parseInt(qtyElement.value) || 0;
                    const subtotal = price * qty;
                    subtotalElement.textContent = subtotal.toFixed(0);
                    grandTotal += subtotal;
                }
            });
            document.getElementById('grand-total').textContent = grandTotal.toFixed(0);
            calculateChange(); // æ•¸é‡æ”¹è®Šæ™‚ä¹Ÿé‡æ–°è¨ˆç®—æ‰¾é›¶
        }

        function calculateChange() {
            const total = parseFloat(document.getElementById('grand-total').textContent) || 0;
            const received = parseFloat(document.getElementById('received-amount').value) || 0;
            const changeElement = document.getElementById('change-amount');
            
            if (received >= total && total > 0) {
                changeElement.textContent = (received - total).toFixed(0);
            } else {
                changeElement.textContent = "0";
            }
        }

        function clearQuantities() {
            document.querySelectorAll('input').forEach(input => {
                input.value = '';
            });
            calculateTotal();
        }

        function saveOrder() {
            let orderDetails = [];
            let currentGrandTotal = 0;

            items.forEach(item => {
                const itemID = `qty-${item}`;
                const itemQty = parseInt(document.getElementById(itemID).value) || 0;
                if (itemQty > 0) {
                    const itemName = document.getElementById(itemID).closest('tr').querySelector('td:first-child').textContent;
                    const itemPrice = parseFloat(document.getElementById(`price-${item}`).textContent);
                    const itemSubtotal = itemPrice * itemQty;
                    orderDetails.push({ name: itemName, qty: itemQty, subtotal: itemSubtotal });
                    currentGrandTotal += itemSubtotal;
                }
            });

            if (orderDetails.length === 0) {
                alert("ç›®å‰è¨‚å–®æ²’æœ‰ä»»ä½•å“é …ï¼Œç„¡æ³•å„²å­˜ã€‚");
                return;
            }

            const timestamp = new Date().toLocaleString('zh-TW', {
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });

            let orderHTML = `
                <div class="saved-order-item" style="border: 2px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; background-color: #f9f9f9; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <p style="font-weight: bold; margin-bottom: 10px; color: #666; border-bottom: 1px dashed #ddd; padding-bottom: 5px;">å„²å­˜æ™‚é–“ï¼š${timestamp}</p>
                    <table style="width: 100%; font-size: 0.9em; margin-top: 0; border-collapse: collapse; table-layout: auto;">
                        <thead>
                            <tr style="background-color: #e0f2f1;">
                                <th style="border: none; text-align: left; padding: 5px;">å“é …</th>
                                <th style="border: none; width: 60px; padding: 5px;">æ•¸é‡</th>
                                <th style="border: none; width: 80px; padding: 5px; text-align: center;">å°è¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            orderDetails.forEach(item => {
                orderHTML += `
                    <tr>
                        <td style="border: none; text-align: left; padding: 3px 5px;">${item.name}</td>
                        <td style="border: none; padding: 3px 5px; text-align: center;">${item.qty}</td>
                        <td style="border: none; padding: 3px 5px; text-align: center; font-weight: bold;">${item.subtotal}</td>
                    </tr>
                `;
            });
            
            orderHTML += `
                        </tbody>
                    </table>
                    <p style="text-align: right; font-size: 1.2em; font-weight: bold; margin-top: 10px; color: #d32f2f; padding-top: 5px; border-top: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
                        <span>ç¸½è¨ˆï¼šNT$ ${currentGrandTotal}</span>
                        <button onclick="deleteOrder(this)" style="background-color: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em;">åˆªé™¤æ­¤ç­†è¨‚å–®</button>
                    </p>
                </div>
            `;

            const historyContainer = document.getElementById('history-container');
            const noHistoryMsg = document.getElementById('no-history-msg');
            if (noHistoryMsg) noHistoryMsg.remove();

            historyContainer.insertAdjacentHTML('beforeend', orderHTML);
            updateLocalStorage();
            clearQuantities(); 
            alert(`è¨‚å–®å·²å„²å­˜ï¼`);
        }

        function deleteOrder(buttonElement) {
            if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨‚å–®ç´€éŒ„å—ï¼Ÿ")) return;
            const orderContainer = buttonElement.closest('.saved-order-item');
            if (orderContainer) {
                orderContainer.remove();
                updateLocalStorage();
            }
            const historyContainer = document.getElementById('history-container');
            if (historyContainer.querySelectorAll('.saved-order-item').length === 0) {
                 if (!document.getElementById('no-history-msg')) {
                    historyContainer.insertAdjacentHTML('beforeend', '<p id="no-history-msg" style="color: #999; text-align: center; margin-top: 20px;">é»æ“Šã€Œå„²å­˜è¨‚å–®ã€å¾Œï¼Œè¨‚å–®å°‡æœƒé¡¯ç¤ºåœ¨æ­¤è™•ã€‚</p>');
                 }
                 localStorage.removeItem('orderHistory');
            }
        }

        function deleteAllOrders() {
            if (!confirm("âš ï¸ è­¦å‘Šï¼šé€™å°‡æœƒæ¸…é™¤ã€Œæ‰€æœ‰ã€å·²å„²å­˜çš„æ­·å²è¨‚å–®ç´€éŒ„ä¸”ç„¡æ³•å¾©åŸï¼ç¢ºå®šè¦æ¸…ç©ºå—ï¼Ÿ")) return;
            
            const historyContainer = document.getElementById('history-container');
            const orderItems = historyContainer.querySelectorAll('.saved-order-item');
            orderItems.forEach(item => item.remove());
            
            if (!document.getElementById('no-history-msg')) {
                historyContainer.insertAdjacentHTML('beforeend', '<p id="no-history-msg" style="color: #999; text-align: center; margin-top: 20px;">é»æ“Šã€Œå„²å­˜è¨‚å–®ã€å¾Œï¼Œè¨‚å–®å°‡æœƒé¡¯ç¤ºåœ¨æ­¤è™•ã€‚</p>');
            }
            
            localStorage.removeItem('orderHistory');
            alert("æ­·å²ç´€éŒ„å·²å…¨éƒ¨æ¸…ç©ºã€‚");
        }
        
        function exportToCSV() {
            const orders = document.querySelectorAll('.saved-order-item');
            if (orders.length === 0) {
                alert("ç›®å‰æ²’æœ‰ç´€éŒ„å¯ä»¥åŒ¯å‡ºã€‚");
                return;
            }
            let csvContent = "è¨‚å–®ID,å„²å­˜æ™‚é–“,è¨‚å–®ç¸½è¨ˆ,å“é …åç¨±,æ•¸é‡,å°è¨ˆ\n";
            let orderCount = 1; 
            orders.forEach(orderDiv => {
                const currentOrderID = orderCount++; 
                const timestamp = orderDiv.querySelector('p:first-child').textContent.replace('å„²å­˜æ™‚é–“ï¼š', '').trim();
                const total = orderDiv.querySelector('p:last-child > span').textContent.replace('ç¸½è¨ˆï¼šNT$ ', '').trim();
                orderDiv.querySelectorAll('tbody tr').forEach(row => {
                    const cells = row.querySelectorAll('td');
                    csvContent += `${currentOrderID},"${timestamp}","${total}","${cells[0].textContent.trim()}",${cells[1].textContent.trim()},${cells[2].textContent.trim()}\n`;
                });
            });
            const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csvContent], { type: 'text/csv;charset=utf-8;' }); 
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `OrderHistory_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}.csv`;
            link.click();
        }
    </script>

</body>
</html>
