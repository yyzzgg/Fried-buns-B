<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‰å°¼æ£®ç¾èªç¹³è²»é€šçŸ¥å–®</title> 
    <style>
        body {
            font-family: 'PingFang TC', 'Heiti TC', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            -webkit-font-smoothing: antialiased;
            margin: 0; padding: 0;
            background-color: #fff8e1; color: #333;
            font-size: 110%; line-height: 1.6; font-weight: 500;
            touch-action: pan-y;
        }
        .header {
            background-color: #ff9800; color: white; padding: 20px; text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header h1 { margin: 0; font-weight: 900; }
        .container {
            max-width: 800px; margin: 40px auto; padding: 20px;
            background-color: white; border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        h2 { color: #d32f2f; border-bottom: 2px solid #ff9800; padding-bottom: 5px; margin-top: 30px; font-size: 1.8em; font-weight: 700; }
        h3 { color: #4CAF50; border-left: 5px solid #4CAF50; padding-left: 10px; margin-top: 30px; font-size: 1.4em; font-weight: 700; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 1em; table-layout: fixed; }
        th, td { border: 1px solid #ccc; padding: 12px 10px; text-align: center; overflow: hidden; font-weight: 600; }
        th { background-color: #f5e0a9; color: #333; font-weight: 900; }
        
        th:nth-child(1), td:nth-child(1) { width: 30%; }
        th:nth-child(2), td:nth-child(2) { width: 22%; }
        th:nth-child(3), td:nth-child(3) { width: 26%; }
        th:nth-child(4), td:nth-child(4) { width: 22%; }

        input[type="tel"] {
            width: 65px; padding: 8px 5px; text-align: center; 
            border: 1px solid #ccc; border-radius: 4px; 
            font-size: 20px; font-weight: 700;
            -webkit-appearance: none; background-color: #fff;
        }
        .received-container { display: flex; align-items: center; justify-content: center; gap: 10px; }
        #received-amount { width: 130px; font-size: 1.3em; font-weight: 900; color: #2e7d32; border: 2px solid #4CAF50; }

        .qty-button {
            background-color: #4CAF50; color: white; border: 1px solid #4CAF50; 
            width: 45px; padding: 8px 0; font-size: 24px; border-radius: 4px; 
            cursor: pointer; touch-action: manipulation;
            -webkit-user-select: none; user-select: none; font-weight: 900;
        }
        .qty-button:active { background-color: #388E3C; }

        .btn-clear-small {
            background-color: #f44336; color: white; border: none; border-radius: 50%;
            width: 35px; height: 35px; font-size: 18px; display: flex; align-items: center; justify-content: center;
        }
        
        .total-row td { font-weight: 900; background-color: #ffe0b2; }
        .change-row td { font-weight: 900; background-color: #e8f5e9; }
        .total-label { text-align: right !important; padding-right: 20px; font-size: 1.2em; }
        #grand-total, #change-amount { font-size: 1.8em !important; font-weight: 900; color: #d32f2f; }
        #change-amount { color: #2e7d32; }
        
        .action-buttons-container { display: flex; justify-content: space-between; margin-top: 20px; gap: 10px; }
        .button-common { padding: 12px 15px; border: none; border-radius: 5px; font-size: 1em; color: white; font-weight: 700; cursor: pointer; }
        .export-button { background-color: #2196F3; }
        .delete-all-button, .clear-button { background-color: #f44336; }
        .save-button { background-color: #4CAF50; }
    </style>
</head>
<body>

    <div class="header"><h1>ğŸ¥Ÿ ç´ é£Ÿç”Ÿç…åŒ… ğŸ¥Ÿ</h1></div>

    <div class="container">
        <h2>å“é …èˆ‡é‡‘é¡è¨ˆç®—</h2>
        <h3>ä¸»é£Ÿ</h3>
        <table>
            <thead><tr><th>å“é …åç¨±</th><th>å–®åƒ¹(NT$)</th><th>è³¼è²·æ•¸é‡</th><th>å°è¨ˆ(NT$)</th></tr></thead>
            <tbody>
                <tr>
                    <td>ç´ é£Ÿç”Ÿç…åŒ…</td><td id="price-sjb">6</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-sjb" pattern="[0-9]*" inputmode="numeric" oninput="calculateTotal()">
                            <button class="qty-button" ontouchstart="startAdjusting('qty-sjb', -1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-sjb', -1)" onmouseup="stopAdjusting()">-</button>
                            <button class="qty-button" ontouchstart="startAdjusting('qty-sjb', 1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-sjb', 1)" onmouseup="stopAdjusting()">+</button>
                        </div>
                    </td><td id="subtotal-sjb">0</td>
                </tr>
                <tr>
                    <td>ç…é¹¹é¤…</td><td id="price-xb">25</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-xb" pattern="[0-9]*" inputmode="numeric" oninput="calculateTotal()">
                            <button class="qty-button" ontouchstart="startAdjusting('qty-xb', -1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-xb', -1)" onmouseup="stopAdjusting()">-</button>
                            <button class="qty-button" ontouchstart="startAdjusting('qty-xb', 1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-xb', 1)" onmouseup="stopAdjusting()">+</button>
                        </div>
                    </td><td id="subtotal-xb">0</td>
                </tr>
                <tr>
                    <td>ç´ éºµç·šç¾¹</td><td id="price-mxg">35</td>
                    <td>
                        <div class="input-group">
                            <input type="tel" id="qty-mxg" pattern="[0-9]*" inputmode="numeric" oninput="calculateTotal()">
                            <button class="qty-button" ontouchstart="startAdjusting('qty-mxg', -1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-mxg', -1)" onmouseup="stopAdjusting()">-</button>
                            <button class="qty-button" ontouchstart="startAdjusting('qty-mxg', 1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-mxg', 1)" onmouseup="stopAdjusting()">+</button>
                        </div>
                    </td><td id="subtotal-mxg">0</td>
                </tr>
            </tbody>
        </table>
        
        <h3>é£²å“</h3>
        <table>
            <thead><tr><th>å“é …åç¨±</th><th>å–®åƒ¹(NT$)</th><th>è³¼è²·æ•¸é‡</th><th>å°è¨ˆ(NT$)</th></tr></thead>
            <tbody>
                <tr>
                    <td>è±†æ¼¿</td><td id="price-dz">20</td>
                    <td><div class="input-group">
                        <input type="tel" id="qty-dz" pattern="[0-9]*" oninput="calculateTotal()">
                        <button class="qty-button" ontouchstart="startAdjusting('qty-dz', -1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-dz', -1)" onmouseup="stopAdjusting()">-</button>
                        <button class="qty-button" ontouchstart="startAdjusting('qty-dz', 1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-dz', 1)" onmouseup="stopAdjusting()">+</button>
                    </div></td><td id="subtotal-dz">0</td>
                </tr>
                <tr>
                    <td>ç´…èŒ¶</td><td id="price-hc">20</td>
                    <td><div class="input-group">
                        <input type="tel" id="qty-hc" pattern="[0-9]*" oninput="calculateTotal()">
                        <button class="qty-button" ontouchstart="startAdjusting('qty-hc', -1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-hc', -1)" onmouseup="stopAdjusting()">-</button>
                        <button class="qty-button" ontouchstart="startAdjusting('qty-hc', 1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-hc', 1)" onmouseup="stopAdjusting()">+</button>
                    </div></td><td id="subtotal-hc">0</td>
                </tr>
                <tr>
                    <td>ç´…èŒ¶è±†æ¼¿</td><td id="price-hcdz">20</td>
                    <td><div class="input-group">
                        <input type="tel" id="qty-hcdz" pattern="[0-9]*" oninput="calculateTotal()">
                        <button class="qty-button" ontouchstart="startAdjusting('qty-hcdz', -1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-hcdz', -1)" onmouseup="stopAdjusting()">-</button>
                        <button class="qty-button" ontouchstart="startAdjusting('qty-hcdz', 1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-hcdz', 1)" onmouseup="stopAdjusting()">+</button>
                    </div></td><td id="subtotal-hcdz">0</td>
                </tr>
                <tr>
                    <td>é®®å¥¶èŒ¶</td><td id="price-xnt">35</td>
                    <td><div class="input-group">
                        <input type="tel" id="qty-xnt" pattern="[0-9]*" oninput="calculateTotal()">
                        <button class="qty-button" ontouchstart="startAdjusting('qty-xnt', -1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-xnt', -1)" onmouseup="stopAdjusting()">-</button>
                        <button class="qty-button" ontouchstart="startAdjusting('qty-xnt', 1)" ontouchend="stopAdjusting()" onmousedown="startAdjusting('qty-xnt', 1)" onmouseup="stopAdjusting()">+</button>
                    </div></td><td id="subtotal-xnt">0</td>
                </tr>
            </tbody>
        </table>

        <table style="margin-top: 40px;">
            <tr class="total-row">
                <td class="total-label" style="border-right: none;"><strong>ç¸½è¨ˆé‡‘é¡</strong></td>
                <td id="grand-total" style="border-left: none; width: 35%;">0</td>
            </tr>
            <tr>
                <td class="total-label" style="border-right: none; background-color: #fffde7;"><strong>å¯¦æ”¶é‡‘é¡</strong></td>
                <td style="border-left: none; width: 35%; background-color: #fffde7;">
                    <div class="received-container">
                        <input type="tel" id="received-amount" pattern="[0-9]*" placeholder="é‡‘é¡" oninput="calculateChange()">
                        <button class="btn-clear-small" onclick="clearReceivedAmount()">âœ•</button>
                    </div>
                </td>
            </tr>
            <tr class="change-row">
                <td class="total-label" style="border-right: none;"><strong>æ‡‰æ‰¾é›¶éŒ¢</strong></td>
                <td id="change-amount" style="border-left: none; width: 35%;">0</td>
            </tr>
        </table>

        <div class="action-buttons-container">
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <button class="button-common export-button" onclick="exportToCSV()">åŒ¯å‡ºç´€éŒ„ (CSV)</button>
                <button class="button-common delete-all-button" onclick="deleteAllOrders()">æ¸…ç©ºæ­·å²</button>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="button-common save-button" onclick="saveOrder()">å„²å­˜è¨‚å–®</button>
                <button class="button-common clear-button" onclick="clearQuantities()">å…¨éƒ¨é‡ç½®</button>
            </div>
        </div>
        
        <p style="text-align: center; margin-top: 15px; font-size: 0.9em; color: #666;">v260110.22</p>
        
        <div id="history-container">
            <h2 style="margin-top: 40px; border-bottom: 2px solid #4CAF50; color: #4CAF50;">æ­·å²è¨‚å–®è¨˜éŒ„</h2>
            <p id="no-history-msg" style="color: #999; text-align: center; margin-top: 20px;">é»æ“Šã€Œå„²å­˜è¨‚å–®ã€å¾Œï¼Œè¨‚å–®å°‡æœƒé¡¯ç¤ºåœ¨æ­¤è™•ã€‚</p>
        </div>
    </div>

    <script>
        const items = ['sjb', 'xb', 'mxg', 'dz', 'hc', 'hcdz', 'xnt'];
        let adjustTimer;

        window.onload = function() {
            const savedHistory = localStorage.getItem('orderHistory');
            if (savedHistory && savedHistory.trim() !== "") {
                const historyContainer = document.getElementById('history-container');
                const noHistoryMsg = document.getElementById('no-history-msg');
                if (noHistoryMsg) noHistoryMsg.remove();
                historyContainer.innerHTML += savedHistory;
            }
            calculateTotal();
        };

        function startAdjusting(itemId, change) {
            adjustQuantity(itemId, change);
            // æ”¹ç‚º 800 æ¯«ç§’æ‰å•Ÿå‹•é€£ç™¼ï¼Œæ¯ 150 æ¯«ç§’è·³å‹•ä¸€æ¬¡
            adjustTimer = setTimeout(() => {
                adjustTimer = setInterval(() => { adjustQuantity(itemId, change); }, 150);
            }, 800);
        }

        function stopAdjusting() {
            clearTimeout(adjustTimer);
            clearInterval(adjustTimer);
        }

        function adjustQuantity(itemId, change) {
            const qtyInput = document.getElementById(itemId);
            let currentQty = parseInt(qtyInput.value) || 0;
            let newQty = Math.max(0, currentQty + change);
            qtyInput.value = (newQty === 0) ? '' : newQty;
            calculateTotal();
        }

        function calculateTotal() {
            let grandTotal = 0;
            items.forEach(item => {
                const price = parseFloat(document.getElementById(`price-${item}`).textContent);
                const qty = parseInt(document.getElementById(`qty-${item}`).value) || 0;
                const subtotal = price * qty;
                document.getElementById(`subtotal-${item}`).textContent = subtotal;
                grandTotal += subtotal;
            });
            document.getElementById('grand-total').textContent = grandTotal;
            calculateChange();
        }

        function calculateChange() {
            const total = parseFloat(document.getElementById('grand-total').textContent) || 0;
            const received = parseFloat(document.getElementById('received-amount').value) || 0;
            document.getElementById('change-amount').textContent = (received >= total && total > 0) ? (received - total) : 0;
        }

        function clearReceivedAmount() { document.getElementById('received-amount').value = ''; calculateChange(); }

        function clearQuantities() {
            document.querySelectorAll('table input[type="tel"]').forEach(input => { input.value = ''; });
            calculateTotal();
        }

        function saveOrder() {
            let orderDetails = [];
            let currentGrandTotal = 0;
            items.forEach(item => {
                const qty = parseInt(document.getElementById(`qty-${item}`).value) || 0;
                if (qty > 0) {
                    const name = document.getElementById(`qty-${item}`).closest('tr').querySelector('td:first-child').textContent;
                    const subtotal = parseFloat(document.getElementById(`subtotal-${item}`).textContent);
                    orderDetails.push({ name, qty, subtotal });
                    currentGrandTotal += subtotal;
                }
            });

            if (orderDetails.length === 0) return alert("è¨‚å–®ç‚ºç©ºï¼");

            const timestamp = new Date().toLocaleString('zh-TW');
            let orderHTML = `<div class="saved-order-item" style="border: 2px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; background-color: #f9f9f9;">
                <p style="font-weight: bold; color: #666;">å„²å­˜æ™‚é–“ï¼š${timestamp}</p>
                <table style="width:100%; font-size: 0.9em; border-collapse: collapse; margin-top:0;">
                    <tr style="background-color: #e0f2f1;"><th style="border:none; text-align:left;">å“é …</th><th style="border:none;">æ•¸é‡</th><th style="border:none;">å°è¨ˆ</th></tr>`;
            orderDetails.forEach(item => { orderHTML += `<tr><td style="border:none; text-align:left;">${item.name}</td><td style="border:none;">${item.qty}</td><td style="border:none; font-weight:bold;">${item.subtotal}</td></tr>`; });
            orderHTML += `</table><p style="text-align: right; font-weight: bold; color: #d32f2f; margin-top:10px; display:flex; justify-content:space-between;"><span>ç¸½è¨ˆï¼šNT$ ${currentGrandTotal}</span><button onclick="deleteOrder(this)" style="background:#f44336; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">åˆªé™¤</button></p></div>`;
            
            const historyContainer = document.getElementById('history-container');
            const noHistoryMsg = document.getElementById('no-history-msg');
            if (noHistoryMsg) noHistoryMsg.remove();
            historyContainer.insertAdjacentHTML('beforeend', orderHTML);
            localStorage.setItem('orderHistory', historyContainer.innerHTML);
            clearQuantities();
            alert("è¨‚å–®å·²å„²å­˜ï¼");
        }

        function deleteOrder(btn) {
            if (!confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) return;
            btn.closest('.saved-order-item').remove();
            localStorage.setItem('orderHistory', document.getElementById('history-container').innerHTML);
        }

        function deleteAllOrders() {
            if (!confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰ç´€éŒ„ï¼Ÿ")) return;
            localStorage.removeItem('orderHistory');
            location.reload();
        }

        function exportToCSV() {
            const orders = document.querySelectorAll('.saved-order-item');
            if (orders.length === 0) return alert("ç„¡ç´€éŒ„");
            let csv = "\uFEFFè¨‚å–®,æ™‚é–“,ç¸½è¨ˆ,å“é …,æ•¸é‡,å°è¨ˆ\n";
            orders.forEach((div, idx) => {
                const time = div.querySelector('p').textContent.replace('å„²å­˜æ™‚é–“ï¼š', '');
                const total = div.querySelector('span').textContent.replace('ç¸½è¨ˆï¼šNT$ ', '');
                div.querySelectorAll('table tr:not(:first-child)').forEach(tr => {
                    const tds = tr.querySelectorAll('td');
                    csv += `${idx+1},"${time}","${total}","${tds[0].textContent}",${tds[1].textContent},${tds[2].textContent}\n`;
                });
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `Orders_${new Date().getTime()}.csv`;
            a.click();
        }
    </script>
</body>
</html>
